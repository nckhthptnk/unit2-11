<!doctype html>
<html lang="vi" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Unit 2: Vietnam and ASEAN</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        .flashcard {
            perspective: 1000px;
            height: 250px;
        }
        
        @media (min-width: 640px) {
            .flashcard {
                height: 300px;
            }
        }
        
        @media (min-width: 1024px) {
            .flashcard {
                height: 320px;
            }
        }
        
        .flashcard-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        
        .flashcard.flipped .flashcard-inner {
            transform: rotateY(180deg);
        }
        
        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .flashcard-back {
            transform: rotateY(180deg);
        }
        
        .highlight {
            background-color: #fef08a;
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .progress-bar {
            transition: width 0.3s ease;
        }
        
        .tab-button {
            transition: all 0.3s ease;
        }
        
        .tab-button.active {
            transform: translateY(-2px);
        }
        
        .grammar-topic {
            transition: all 0.3s ease;
        }
        
        .grammar-topic:hover {
            transform: translateX(5px);
        }
        
        .quiz-option {
            transition: all 0.2s ease;
        }
        
        .quiz-option:hover {
            transform: scale(1.02);
        }
        
        .correct {
            background-color: #dcfce7 !important;
            border-color: #16a34a !important;
        }
        
        .incorrect {
            background-color: #fef2f2 !important;
            border-color: #dc2626 !important;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full bg-gradient-to-br from-blue-50 to-indigo-100 font-sans">
  <div class="min-h-full p-2 sm:p-4"><!-- Header -->
   <header class="bg-white rounded-lg shadow-lg p-4 sm:p-6 mb-4 sm:mb-6"><!-- Home button - Top left -->
    <div class="mb-4"><a id="home-link" href="https://nckhthptnk.github.io/tienganh11/" target="_blank" rel="noopener noreferrer" class="inline-flex items-center bg-indigo-600 text-white px-3 py-2 sm:px-4 sm:py-2 rounded-lg hover:bg-indigo-700 transition-colors text-sm sm:text-base"> 🏠 <span class="ml-1 sm:ml-2">Trang chủ</span> </a>
    </div><!-- Title and welcome message - Center -->
    <div class="text-center mb-4">
     <h1 id="unit-title" class="text-2xl sm:text-3xl lg:text-4xl font-bold text-indigo-800 mb-2">Unit 2: Vietnam and ASEAN</h1>
     <p class="text-sm sm:text-base lg:text-lg text-gray-600 font-medium">Chào mừng bạn đến với bài học Tiếng Anh cùng Mega Master 11 nhé!</p>
    </div><!-- Progress Section -->
    <div class="bg-gray-50 rounded-lg p-3 sm:p-4">
     <h2 class="text-lg sm:text-xl font-semibold text-gray-800 mb-3 sm:mb-4 text-center">📊 Tiến độ học tập</h2>
     <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4">
      <div class="text-center bg-white rounded-lg p-3 shadow-sm">
       <div class="text-xl sm:text-2xl font-bold text-indigo-600" id="total-progress">
        0%
       </div>
       <div class="text-xs sm:text-sm text-gray-600 mb-2">
        Tổng
       </div>
       <div class="w-full bg-gray-200 rounded-full h-2">
        <div class="bg-indigo-600 h-2 rounded-full progress-bar" id="total-bar" style="width: 0%"></div>
       </div>
      </div>
      <div class="text-center bg-white rounded-lg p-3 shadow-sm">
       <div class="text-xl sm:text-2xl font-bold text-green-600" id="vocab-progress">
        0%
       </div>
       <div class="text-xs sm:text-sm text-gray-600 mb-2">
        Từ vựng
       </div>
       <div class="w-full bg-gray-200 rounded-full h-2">
        <div class="bg-green-600 h-2 rounded-full progress-bar" id="vocab-bar" style="width: 0%"></div>
       </div>
      </div>
      <div class="text-center bg-white rounded-lg p-3 shadow-sm">
       <div class="text-xl sm:text-2xl font-bold text-blue-600" id="reading-progress">
        0%
       </div>
       <div class="text-xs sm:text-sm text-gray-600 mb-2">
        Bài đọc
       </div>
       <div class="w-full bg-gray-200 rounded-full h-2">
        <div class="bg-blue-600 h-2 rounded-full progress-bar" id="reading-bar" style="width: 0%"></div>
       </div>
      </div>
      <div class="text-center bg-white rounded-lg p-3 shadow-sm">
       <div class="text-xl sm:text-2xl font-bold text-purple-600" id="grammar-progress">
        0%
       </div>
       <div class="text-xs sm:text-sm text-gray-600 mb-2">
        Ngữ pháp
       </div>
       <div class="w-full bg-gray-200 rounded-full h-2">
        <div class="bg-purple-600 h-2 rounded-full progress-bar" id="grammar-bar" style="width: 0%"></div>
       </div>
      </div>
     </div>
    </div>
   </header><!-- Navigation Tabs -->
   <div class="bg-white rounded-lg shadow-lg mb-4 sm:mb-6">
    <div class="flex"><button class="tab-button flex-1 py-3 px-2 sm:py-4 sm:px-6 text-center font-semibold rounded-tl-lg bg-green-500 text-white active text-xs sm:text-sm lg:text-base" data-tab="vocabulary"> <span class="block sm:inline">📚</span> <span class="block sm:inline">Từ vựng</span> </button> <button class="tab-button flex-1 py-3 px-2 sm:py-4 sm:px-6 text-center font-semibold bg-gray-200 text-gray-700 hover:bg-gray-300 text-xs sm:text-sm lg:text-base" data-tab="reading"> <span class="block sm:inline">📖</span> <span class="block sm:inline">Bài đọc</span> </button> <button class="tab-button flex-1 py-3 px-2 sm:py-4 sm:px-6 text-center font-semibold rounded-tr-lg bg-gray-200 text-gray-700 hover:bg-gray-300 text-xs sm:text-sm lg:text-base" data-tab="grammar"> <span class="block sm:inline">📝</span> <span class="block sm:inline">Ngữ pháp</span> </button>
    </div>
   </div><!-- Content Sections -->
   <main class="bg-white rounded-lg shadow-lg p-3 sm:p-4 lg:p-6"><!-- Vocabulary Section -->
    <section id="vocabulary-section" class="tab-content">
     <div class="text-center mb-4 sm:mb-6">
      <h2 class="text-xl sm:text-2xl font-bold text-green-700 mb-2">Từ vựng Unit 2</h2>
      <p class="text-sm sm:text-base text-gray-600 px-2">Sử dụng phím mũi tên ← → để điều hướng, Space để lật thẻ</p>
     </div>
     <div class="max-w-sm sm:max-w-md mx-auto mb-4 sm:mb-6 px-2">
      <div class="flashcard" id="flashcard">
       <div class="flashcard-inner">
        <div class="flashcard-front bg-gradient-to-br from-green-400 to-green-600 text-white">
         <div class="text-2xl sm:text-3xl font-bold mb-3 sm:mb-4 px-2" id="word-text">
          association
         </div>
         <div class="text-base sm:text-lg mb-2" id="word-type">
          (n)
         </div>
         <div class="text-xs sm:text-sm px-2" id="word-ipa">
          /əˌsoʊsiˈeɪʃən/
         </div>
        </div>
        <div class="flashcard-back bg-gradient-to-br from-blue-400 to-blue-600 text-white">
         <div class="text-lg sm:text-xl font-semibold mb-3 sm:mb-4 px-2" id="word-meaning">
          hiệp hội, liên minh
         </div>
         <div class="text-xs sm:text-sm italic px-2" id="word-example">
          "ASEAN is an important association in Southeast Asia."
         </div>
        </div>
       </div>
      </div>
     </div>
     <div class="flex justify-center space-x-2 sm:space-x-4 mb-4 px-2"><button id="prev-word" class="bg-gray-500 text-white px-3 py-2 sm:px-6 sm:py-3 rounded-lg hover:bg-gray-600 transition-colors text-sm sm:text-base"> <span class="hidden sm:inline">← Trước</span> <span class="sm:hidden">←</span> </button> <button id="flip-card" class="bg-yellow-500 text-white px-3 py-2 sm:px-6 sm:py-3 rounded-lg hover:bg-yellow-600 transition-colors text-sm sm:text-base"> <span class="hidden sm:inline">🔄 Lật thẻ</span> <span class="sm:hidden">🔄</span> </button> <button id="next-word" class="bg-green-500 text-white px-3 py-2 sm:px-6 sm:py-3 rounded-lg hover:bg-green-600 transition-colors text-sm sm:text-base"> <span class="hidden sm:inline">Tiếp →</span> <span class="sm:hidden">→</span> </button>
     </div>
     <div class="text-center text-gray-600 text-sm sm:text-base"><span id="word-counter">1 / 41</span>
     </div><!-- Vocabulary Quiz Section -->
     <div class="mt-6 sm:mt-8 border-t pt-4 sm:pt-6">
      <h3 class="text-lg sm:text-xl font-bold text-green-700 mb-3 sm:mb-4 text-center">📝 Kiểm tra từ vựng</h3>
      <div class="text-center mb-4 px-2">
       <p class="text-sm sm:text-base text-gray-600 mb-3">📝 Bài kiểm tra gồm 42 câu hỏi trắc nghiệm về từ vựng Unit 2</p><button id="start-vocab-quiz" class="bg-green-600 text-white px-4 py-2 sm:px-6 sm:py-3 rounded-lg hover:bg-green-700 transition-colors text-sm sm:text-base"> Bắt đầu kiểm tra (42 câu) </button>
      </div>
      <div id="vocab-quiz-container" class="hidden">
       <div class="max-w-2xl mx-auto px-2">
        <div class="mb-3 sm:mb-4 text-center"><span class="text-base sm:text-lg font-semibold">Câu <span id="vocab-quiz-current">1</span> / <span id="vocab-quiz-total">42</span></span>
        </div>
        <div class="bg-gray-50 rounded-lg p-3 sm:p-4 lg:p-6 mb-4 sm:mb-6">
         <h4 class="text-lg sm:text-xl font-semibold mb-3 sm:mb-4" id="vocab-question"></h4>
         <div id="vocab-options" class="space-y-2 sm:space-y-3"><!-- Options will be inserted here -->
         </div>
        </div>
        <div class="flex justify-center space-x-2 sm:space-x-4"><button id="vocab-quiz-submit" class="bg-blue-600 text-white px-4 py-2 sm:px-6 sm:py-3 rounded-lg hover:bg-blue-700 transition-colors hidden text-sm sm:text-base"> Xác nhận </button> <button id="vocab-quiz-next" class="bg-green-600 text-white px-4 py-2 sm:px-6 sm:py-3 rounded-lg hover:bg-green-700 transition-colors hidden text-sm sm:text-base"> Câu tiếp theo </button>
        </div>
        <div id="vocab-quiz-result" class="mt-4 sm:mt-6 hidden"></div>
        <div id="vocab-quiz-final" class="mt-4 sm:mt-6 hidden"></div>
       </div>
      </div>
     </div>
    </section><!-- Reading Section -->
    <section id="reading-section" class="tab-content hidden">
     <h2 class="text-xl sm:text-2xl font-bold text-blue-700 mb-4 sm:mb-6 text-center">Bài đọc: Vietnam and ASEAN</h2>
     <div class="bg-gray-50 rounded-lg p-3 sm:p-4 lg:p-6 mb-4 sm:mb-6">
      <div class="text-sm sm:text-base lg:text-lg leading-relaxed" id="reading-text">
       Vietnam became a member of the <span class="highlight">Association</span> of Southeast Asian Nations (ASEAN) in 1995. This membership has brought significant benefits to Vietnam's economy and international relations. ASEAN promotes <span class="highlight">cooperation</span> among member countries in various fields including trade, education, and <span class="highlight">culture</span>. The organization has helped Vietnam integrate into the global economy more effectively. Through ASEAN, Vietnam has access to a larger market and can participate in regional initiatives. The country has also benefited from investment opportunities and technology transfer from <span class="highlight">other</span> ASEAN members. Vietnam's <span class="highlight">historical</span> sites and <span class="highlight">picturesque</span> landscapes have become <span class="highlight">popular</span> tourist attractions, attracting visitors from <span class="highlight">another</span> ASEAN countries. Vietnam's contribution to ASEAN includes its rich cultural heritage, growing economy, and strategic location. The country's ancient <span class="highlight">temples</span>, <span class="highlight">pagodas</span>, and <span class="highlight">palaces</span> showcase its unique <span class="highlight">architecture</span>. From the <span class="highlight">mountains</span> in the north to the <span class="highlight">bays</span> in the south, Vietnam offers diverse natural beauty. The country actively participates in ASEAN summits and works towards maintaining peace and stability in the region. I would <span class="highlight">recommend</span> that visitors explore Vietnam's cultural sites to understand the <span class="highlight">wisdom</span> of its ancestors. This partnership continues to strengthen Vietnam's position in Southeast Asia and beyond.
      </div>
     </div>
     <div id="reading-quiz">
      <h3 class="text-lg sm:text-xl font-semibold mb-3 sm:mb-4 text-center">Câu hỏi trắc nghiệm</h3>
      <div id="quiz-container" class="px-2"></div>
      <div class="text-center"><button id="submit-reading-quiz" class="bg-blue-600 text-white px-4 py-2 sm:px-6 sm:py-3 rounded-lg hover:bg-blue-700 transition-colors mt-4 hidden text-sm sm:text-base"> Nộp bài </button>
      </div>
      <div id="reading-result" class="mt-4 hidden px-2"></div>
     </div>
    </section><!-- Grammar Section -->
    <section id="grammar-section" class="tab-content hidden">
     <h2 class="text-xl sm:text-2xl font-bold text-purple-700 mb-4 sm:mb-6 text-center">Ngữ pháp Unit 2</h2>
     <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 mb-4 sm:mb-6 px-2">
      <div class="grammar-topic bg-gray-50 p-3 sm:p-4 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors" data-topic="past-continuous">
       <h3 class="font-semibold text-base sm:text-lg">Past Continuous</h3>
       <p class="text-gray-600 text-xs sm:text-sm">Thì quá khứ tiếp diễn</p>
      </div>
      <div class="grammar-topic bg-gray-50 p-3 sm:p-4 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors" data-topic="cleft-sentence">
       <h3 class="font-semibold text-base sm:text-lg">Cleft Sentences</h3>
       <p class="text-gray-600 text-xs sm:text-sm">Câu chẻ</p>
      </div>
      <div class="grammar-topic bg-gray-50 p-3 sm:p-4 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors" data-topic="articles">
       <h3 class="font-semibold text-base sm:text-lg">Articles (a/an/the)</h3>
       <p class="text-gray-600 text-xs sm:text-sm">Mạo từ</p>
      </div>
      <div class="grammar-topic bg-gray-50 p-3 sm:p-4 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors" data-topic="its-time">
       <h3 class="font-semibold text-base sm:text-lg">It's time</h3>
       <p class="text-gray-600 text-xs sm:text-sm">Cấu trúc "It's time"</p>
      </div>
      <div class="grammar-topic bg-gray-50 p-3 sm:p-4 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors" data-topic="would-rather">
       <h3 class="font-semibold text-base sm:text-lg">Would rather</h3>
       <p class="text-gray-600 text-xs sm:text-sm">Cấu trúc "Would rather"</p>
      </div>
      <div class="grammar-topic bg-purple-100 p-3 sm:p-4 rounded-lg cursor-pointer hover:bg-purple-200 transition-colors sm:col-span-2" data-topic="comprehensive-quiz">
       <h3 class="font-semibold text-base sm:text-lg text-purple-700 text-center">📝 Bài tập tổng hợp</h3>
       <p class="text-purple-600 text-xs sm:text-sm text-center">30 câu trắc nghiệm</p>
      </div>
     </div>
     <div id="grammar-content" class="bg-gray-50 rounded-lg p-3 sm:p-4 lg:p-6 hidden"><!-- Grammar theory content will be inserted here -->
     </div>
    </section>
   </main>
  </div>
  <script>
        // Vocabulary data
        const vocabularyData = [
            {
                word: "take away",
                type: "(phrasal verb)",
                ipa: "/teɪk əˈweɪ/",
                meaning: "mang đi, lấy đi",
                example: "Please take away these dishes after dinner."
            },
            {
                word: "conserve",
                type: "(v)",
                ipa: "/kənˈsɜːrv/",
                meaning: "bảo tồn, giữ gìn",
                example: "We must conserve our natural resources."
            },
            {
                word: "historical",
                type: "(adj)",
                ipa: "/hɪˈstɔːrɪkəl/",
                meaning: "thuộc về lịch sử",
                example: "This is a historical building from the 15th century."
            },
            {
                word: "picturesque",
                type: "(adj)",
                ipa: "/ˌpɪktʃəˈresk/",
                meaning: "đẹp như tranh",
                example: "The village is very picturesque with its old houses."
            },
            {
                word: "another",
                type: "(determiner)",
                ipa: "/əˈnʌðər/",
                meaning: "một cái khác",
                example: "Would you like another cup of coffee?"
            },
            {
                word: "other",
                type: "(determiner)",
                ipa: "/ˈʌðər/",
                meaning: "khác",
                example: "I have other plans for tonight."
            },
            {
                word: "others",
                type: "(pronoun)",
                ipa: "/ˈʌðərz/",
                meaning: "những cái khác",
                example: "Some students passed, but others failed."
            },
            {
                word: "the other",
                type: "(determiner)",
                ipa: "/ði ˈʌðər/",
                meaning: "cái còn lại",
                example: "I have two books. One is red, the other is blue."
            },
            {
                word: "the others",
                type: "(pronoun)",
                ipa: "/ði ˈʌðərz/",
                meaning: "những cái còn lại",
                example: "Three students left early, the others stayed."
            },
            {
                word: "each other",
                type: "(pronoun)",
                ipa: "/iːtʃ ˈʌðər/",
                meaning: "lẫn nhau (2 người)",
                example: "They love each other very much."
            },
            {
                word: "one another",
                type: "(pronoun)",
                ipa: "/wʌn əˈnʌðər/",
                meaning: "lẫn nhau (3+ người)",
                example: "The team members help one another."
            },
            {
                word: "mountain",
                type: "(n)",
                ipa: "/ˈmaʊntən/",
                meaning: "núi",
                example: "Mount Everest is the highest mountain in the world."
            },
            {
                word: "valley",
                type: "(n)",
                ipa: "/ˈvæli/",
                meaning: "thung lũng",
                example: "The valley is surrounded by high mountains."
            },
            {
                word: "dune",
                type: "(n)",
                ipa: "/duːn/",
                meaning: "đồi cát",
                example: "The sand dunes in the desert are beautiful."
            },
            {
                word: "bay",
                type: "(n)",
                ipa: "/beɪ/",
                meaning: "vịnh",
                example: "Ha Long Bay is famous for its limestone islands."
            },
            {
                word: "cave",
                type: "(n)",
                ipa: "/keɪv/",
                meaning: "hang động",
                example: "We explored the cave with flashlights."
            },
            {
                word: "waterfall",
                type: "(n)",
                ipa: "/ˈwɔːtərfɔːl/",
                meaning: "thác nước",
                example: "The waterfall creates a beautiful rainbow."
            },
            {
                word: "architecture",
                type: "(n)",
                ipa: "/ˈɑːrkɪtektʃər/",
                meaning: "kiến trúc",
                example: "The architecture of this building is impressive."
            },
            {
                word: "cathedral",
                type: "(n)",
                ipa: "/kəˈθiːdrəl/",
                meaning: "nhà thờ lớn",
                example: "Notre Dame is a famous cathedral in Paris."
            },
            {
                word: "pagoda",
                type: "(n)",
                ipa: "/pəˈɡoʊdə/",
                meaning: "chùa",
                example: "The pagoda is a place of worship for Buddhists."
            },
            {
                word: "tower",
                type: "(n)",
                ipa: "/ˈtaʊər/",
                meaning: "tháp",
                example: "The Eiffel Tower is a symbol of Paris."
            },
            {
                word: "citadel",
                type: "(n)",
                ipa: "/ˈsɪtədəl/",
                meaning: "thành trì",
                example: "The citadel was built to protect the city."
            },
            {
                word: "palace",
                type: "(n)",
                ipa: "/ˈpæləs/",
                meaning: "cung điện",
                example: "The royal palace is open to tourists."
            },
            {
                word: "tomb",
                type: "(n)",
                ipa: "/tuːm/",
                meaning: "lăng mộ",
                example: "The emperor's tomb is a historical site."
            },
            {
                word: "tourist attraction",
                type: "(n)",
                ipa: "/ˈtʊrɪst əˈtrækʃən/",
                meaning: "điểm thu hút khách du lịch",
                example: "The museum is a popular tourist attraction."
            },
            {
                word: "symbol",
                type: "(n)",
                ipa: "/ˈsɪmbəl/",
                meaning: "biểu tượng",
                example: "The lotus is a symbol of purity in Vietnam."
            },
            {
                word: "worship",
                type: "(v)",
                ipa: "/ˈwɜːrʃɪp/",
                meaning: "thờ cúng, tôn thờ",
                example: "People worship their ancestors in the temple."
            },
            {
                word: "flavour",
                type: "(n)",
                ipa: "/ˈfleɪvər/",
                meaning: "hương vị",
                example: "This dish has a unique flavour."
            },
            {
                word: "stall",
                type: "(n)",
                ipa: "/stɔːl/",
                meaning: "quầy hàng",
                example: "She bought fruit from a street stall."
            },
            {
                word: "wisdom",
                type: "(n)",
                ipa: "/ˈwɪzdəm/",
                meaning: "trí tuệ",
                example: "Age brings wisdom and experience."
            },
            {
                word: "recommend",
                type: "(v)",
                ipa: "/ˌrekəˈmend/",
                meaning: "khuyên, giới thiệu",
                example: "I recommend this restaurant to everyone."
            },
            {
                word: "take off",
                type: "(phrasal verb)",
                ipa: "/teɪk ɔːf/",
                meaning: "cởi ra, cất cánh",
                example: "Please take off your shoes before entering."
            },
            {
                word: "culture",
                type: "(n)",
                ipa: "/ˈkʌltʃər/",
                meaning: "văn hóa",
                example: "Vietnamese culture is rich and diverse."
            },
            {
                word: "explain",
                type: "(v)",
                ipa: "/ɪkˈspleɪn/",
                meaning: "giải thích",
                example: "Can you explain this grammar rule to me?"
            },
            {
                word: "historic",
                type: "(adj)",
                ipa: "/hɪˈstɔːrɪk/",
                meaning: "có ý nghĩa lịch sử",
                example: "This is a historic moment for our country."
            },
            {
                word: "locate",
                type: "(v)",
                ipa: "/ˈloʊkeɪt/",
                meaning: "định vị, tìm thấy",
                example: "Can you locate Vietnam on this map?"
            },
            {
                word: "peaceful",
                type: "(adj)",
                ipa: "/ˈpiːsfəl/",
                meaning: "yên bình",
                example: "The countryside is very peaceful."
            },
            {
                word: "political",
                type: "(adj)",
                ipa: "/pəˈlɪtɪkəl/",
                meaning: "thuộc về chính trị",
                example: "He is interested in political science."
            },
            {
                word: "pond",
                type: "(n)",
                ipa: "/pɑːnd/",
                meaning: "ao",
                example: "There are fish swimming in the pond."
            },
            {
                word: "popular",
                type: "(adj)",
                ipa: "/ˈpɑːpjələr/",
                meaning: "phổ biến",
                example: "Pho is a popular Vietnamese dish."
            },
            {
                word: "ready",
                type: "(adj)",
                ipa: "/ˈredi/",
                meaning: "sẵn sàng",
                example: "Are you ready to go to school?"
            },
            {
                word: "temple",
                type: "(n)",
                ipa: "/ˈtempəl/",
                meaning: "đền, miếu",
                example: "The Temple of Literature is in Hanoi."
            }
        ];

        // Reading quiz questions
        const readingQuestions = [
            {
                question: "When did Vietnam become a member of ASEAN?",
                options: ["1993", "1995", "1997", "1999"],
                correct: 1
            },
            {
                question: "What fields does ASEAN promote cooperation in?",
                options: ["Only trade", "Trade, education, and culture", "Only education", "Only culture"],
                correct: 1
            },
            {
                question: "What has made Vietnam's sites become popular tourist attractions?",
                options: ["Only modern buildings", "Historical sites and picturesque landscapes", "Only natural beauty", "Only cultural events"],
                correct: 1
            },
            {
                question: "What showcases Vietnam's unique architecture according to the passage?",
                options: ["Modern buildings", "Ancient temples, pagodas, and palaces", "Shopping centers", "Office buildings"],
                correct: 1
            },
            {
                question: "What natural features does Vietnam offer from north to south?",
                options: ["Only mountains", "Mountains in the north to bays in the south", "Only coastal areas", "Only rivers and lakes"],
                correct: 1
            }
        ];

        // Grammar content
        const grammarContent = {
            "past-continuous": {
                title: "Past Continuous (Thì quá khứ tiếp diễn)",
                content: `
                    <h3 class="text-xl font-semibold mb-4">Cấu trúc:</h3>
                    <div class="bg-blue-50 p-4 rounded-lg mb-4">
                        <p><strong>Khẳng định:</strong> S + was/were + V-ing</p>
                        <p><strong>Phủ định:</strong> S + was/were + not + V-ing</p>
                        <p><strong>Nghi vấn:</strong> Was/Were + S + V-ing?</p>
                    </div>
                    
                    <h3 class="text-xl font-semibold mb-4">Cách sử dụng:</h3>
                    <ul class="list-disc list-inside mb-4 space-y-2">
                        <li>Diễn tả hành động đang xảy ra tại một thời điểm cụ thể trong quá khứ</li>
                        <li>Diễn tả hành động đang xảy ra thì có hành động khác xen vào</li>
                        <li>Diễn tả hai hành động đang xảy ra song song trong quá khứ</li>
                    </ul>
                    
                    <h3 class="text-xl font-semibold mb-4">Ví dụ:</h3>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <p>• I was studying when you called me.</p>
                        <p>• They were discussing ASEAN cooperation at 3 PM yesterday.</p>
                        <p>• While Vietnam was developing its economy, it was also strengthening international relations.</p>
                    </div>
                `
            },
            "cleft-sentence": {
                title: "Cleft Sentences (Câu chẻ)",
                content: `
                    <h3 class="text-xl font-semibold mb-4">Cấu trúc:</h3>
                    <div class="bg-blue-50 p-4 rounded-lg mb-4">
                        <p><strong>It + be + focus + that/who + clause</strong></p>
                        <p><strong>What + clause + be + focus</strong></p>
                    </div>
                    
                    <h3 class="text-xl font-semibold mb-4">Cách sử dụng:</h3>
                    <ul class="list-disc list-inside mb-4 space-y-2">
                        <li>Nhấn mạnh một thành phần cụ thể trong câu</li>
                        <li>Tạo sự tập trung vào thông tin quan trọng</li>
                        <li>Làm cho câu văn sinh động và có trọng tâm rõ ràng</li>
                    </ul>
                    
                    <h3 class="text-xl font-semibold mb-4">Ví dụ:</h3>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <p>• It was in 1995 that Vietnam joined ASEAN.</p>
                        <p>• It is cooperation that makes ASEAN strong.</p>
                        <p>• What Vietnam needs is more international investment.</p>
                    </div>
                `
            },
            "articles": {
                title: "Articles: a/an/the (Mạo từ)",
                content: `
                    <h3 class="text-xl font-semibold mb-4">Mạo từ không xác định (a/an):</h3>
                    <div class="bg-blue-50 p-4 rounded-lg mb-4">
                        <p><strong>a:</strong> trước phụ âm</p>
                        <p><strong>an:</strong> trước nguyên âm (a, e, i, o, u)</p>
                    </div>
                    
                    <h3 class="text-xl font-semibold mb-4">Mạo từ xác định (the):</h3>
                    <ul class="list-disc list-inside mb-4 space-y-2">
                        <li>Trước danh từ đã được xác định cụ thể</li>
                        <li>Trước danh từ duy nhất</li>
                        <li>Trước tên tổ chức, hiệp hội</li>
                        <li>Trước so sánh nhất</li>
                    </ul>
                    
                    <h3 class="text-xl font-semibold mb-4">Ví dụ:</h3>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <p>• Vietnam is a member of ASEAN.</p>
                        <p>• The ASEAN summit is held annually.</p>
                        <p>• It's the most important organization in Southeast Asia.</p>
                    </div>
                `
            },
            "its-time": {
                title: "It's time (Cấu trúc 'It's time')",
                content: `
                    <h3 class="text-xl font-semibold mb-4">Cấu trúc:</h3>
                    <div class="bg-blue-50 p-4 rounded-lg mb-4">
                        <p><strong>It's time + (for sb) + to V:</strong> Đã đến lúc làm gì</p>
                        <p><strong>It's time + S + V2/Ved:</strong> Đã đến lúc ai đó nên làm gì</p>
                    </div>
                    
                    <h3 class="text-xl font-semibold mb-4">Cách sử dụng:</h3>
                    <ul class="list-disc list-inside mb-4 space-y-2">
                        <li>Diễn tả việc gì đó cần được thực hiện ngay</li>
                        <li>Thể hiện sự cấp thiết hoặc sự cần thiết</li>
                        <li>Đưa ra lời khuyên hoặc gợi ý</li>
                    </ul>
                    
                    <h3 class="text-xl font-semibold mb-4">Ví dụ:</h3>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <p>• It's time for Vietnam to strengthen its economy.</p>
                        <p>• It's time we promoted more cultural exchange.</p>
                        <p>• It's time ASEAN countries worked together more closely.</p>
                    </div>
                `
            },
            "would-rather": {
                title: "Would rather (Cấu trúc 'Would rather')",
                content: `
                    <h3 class="text-xl font-semibold mb-4">Cấu trúc:</h3>
                    <div class="bg-blue-50 p-4 rounded-lg mb-4">
                        <p><strong>S + would rather + V (bare infinitive):</strong> Ai đó thích làm gì hơn</p>
                        <p><strong>S + would rather + S + V2/Ved:</strong> Ai đó muốn người khác làm gì</p>
                    </div>
                    
                    <h3 class="text-xl font-semibold mb-4">Cách sử dụng:</h3>
                    <ul class="list-disc list-inside mb-4 space-y-2">
                        <li>Diễn tả sự ưa thích, lựa chọn</li>
                        <li>So sánh giữa hai lựa chọn</li>
                        <li>Thể hiện mong muốn về hành động của người khác</li>
                    </ul>
                    
                    <h3 class="text-xl font-semibold mb-4">Ví dụ:</h3>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <p>• I would rather study economics than politics.</p>
                        <p>• Vietnam would rather cooperate than compete.</p>
                        <p>• I would rather you attended the ASEAN meeting.</p>
                    </div>
                `
            }
        };

        // Comprehensive quiz questions
        const comprehensiveQuiz = [
            {
                question: "While Vietnam _____ its economy, ASEAN was expanding its membership.",
                options: ["developed", "was developing", "develops", "has developed"],
                correct: 1
            },
            {
                question: "It was in 1995 _____ Vietnam became an ASEAN member.",
                options: ["when", "that", "which", "where"],
                correct: 1
            },
            {
                question: "ASEAN is _____ most important organization in Southeast Asia.",
                options: ["a", "an", "the", "no article"],
                correct: 2
            },
            {
                question: "It's time for Vietnam _____ its international cooperation.",
                options: ["strengthen", "to strengthen", "strengthening", "strengthened"],
                correct: 1
            },
            {
                question: "I would rather _____ about ASEAN's economic benefits.",
                options: ["learn", "learning", "to learn", "learned"],
                correct: 0
            },
            {
                question: "What Vietnam needs _____ more foreign investment.",
                options: ["are", "is", "were", "have been"],
                correct: 1
            },
            {
                question: "They _____ the meeting when the phone rang.",
                options: ["discussed", "were discussing", "have discussed", "discuss"],
                correct: 1
            },
            {
                question: "It's _____ Association of Southeast Asian Nations that promotes regional cooperation.",
                options: ["a", "an", "the", "no article"],
                correct: 2
            },
            {
                question: "It's time we _____ more attention to environmental issues.",
                options: ["pay", "paid", "paying", "to pay"],
                correct: 1
            },
            {
                question: "I would rather you _____ the ASEAN summit next month.",
                options: ["attend", "attended", "attending", "to attend"],
                correct: 1
            },
            {
                question: "It was cooperation _____ made ASEAN successful.",
                options: ["who", "which", "that", "what"],
                correct: 2
            },
            {
                question: "While the delegates _____, the media was preparing their reports.",
                options: ["negotiated", "were negotiating", "negotiate", "have negotiated"],
                correct: 1
            },
            {
                question: "Vietnam joined _____ ASEAN in 1995.",
                options: ["a", "an", "the", "no article"],
                correct: 3
            },
            {
                question: "It's time for _____ countries to work together more closely.",
                options: ["a", "an", "the", "no article"],
                correct: 2
            },
            {
                question: "What I appreciate most _____ ASEAN's commitment to peace.",
                options: ["are", "is", "were", "have been"],
                correct: 1
            },
            {
                question: "She would rather _____ economics than politics at university.",
                options: ["study", "studying", "to study", "studied"],
                correct: 0
            },
            {
                question: "It was in Bangkok _____ the ASEAN headquarters is located.",
                options: ["where", "that", "which", "when"],
                correct: 1
            },
            {
                question: "While Vietnam _____ rapid economic growth, it maintained political stability.",
                options: ["experienced", "was experiencing", "experiences", "has experienced"],
                correct: 1
            },
            {
                question: "ASEAN promotes _____ free trade among member countries.",
                options: ["a", "an", "the", "no article"],
                correct: 3
            },
            {
                question: "It's time the government _____ more investment in education.",
                options: ["make", "made", "making", "to make"],
                correct: 1
            },
            {
                question: "I would rather _____ Vietnamese culture to foreign visitors.",
                options: ["explain", "explaining", "to explain", "explained"],
                correct: 0
            },
            {
                question: "What makes ASEAN unique _____ its diversity and unity.",
                options: ["are", "is", "were", "have been"],
                correct: 1
            },
            {
                question: "It was through ASEAN _____ Vietnam expanded its international relations.",
                options: ["who", "which", "that", "what"],
                correct: 2
            },
            {
                question: "They _____ about regional security when the news broke.",
                options: ["talked", "were talking", "talk", "have talked"],
                correct: 1
            },
            {
                question: "_____ Pacific Ocean borders many ASEAN countries.",
                options: ["A", "An", "The", "No article"],
                correct: 2
            },
            {
                question: "It's time for students _____ more about ASEAN history.",
                options: ["learn", "to learn", "learning", "learned"],
                correct: 1
            },
            {
                question: "The minister would rather _____ the conference in person.",
                options: ["attend", "attending", "to attend", "attended"],
                correct: 0
            },
            {
                question: "What concerns us most _____ the environmental challenges.",
                options: ["are", "is", "were", "have been"],
                correct: 1
            },
            {
                question: "It was cultural exchange _____ strengthened ASEAN bonds.",
                options: ["who", "which", "that", "what"],
                correct: 2
            },
            {
                question: "While the economy _____, social issues also needed attention.",
                options: ["grew", "was growing", "grows", "has grown"],
                correct: 1
            }
        ];

        // Global variables
        let currentWordIndex = 0;
        let isFlipped = false;
        let currentTab = 'vocabulary';
        let vocabQuizData = [];
        let currentVocabQuizIndex = 0;
        let vocabQuizScore = 0;
        let vocabQuizAnswers = [];
        let progressData = {
            vocabulary_progress: 0,
            reading_progress: 0,
            grammar_progress: 0,
            vocabulary_current_index: 0,
            reading_completed: false,
            grammar_completed_topics: '',
            quiz_scores: ''
        };

        // SDK Configuration
        const defaultConfig = {
            unit_title: "Unit 2: Vietnam and ASEAN",
            home_url: "https://nckhthptnk.github.io/tienganh11/"
        };

        // Data handler for progress tracking
        const dataHandler = {
            onDataChanged(data) {
                if (data.length > 0) {
                    progressData = { ...progressData, ...data[0] };
                    updateProgressDisplay();
                    updateVocabularyDisplay();
                }
            }
        };

        // Element SDK functions
        async function onConfigChange(config) {
            const unitTitle = config.unit_title || defaultConfig.unit_title;
            const homeUrl = config.home_url || defaultConfig.home_url;
            
            document.getElementById('unit-title').textContent = unitTitle;
            document.getElementById('home-link').href = homeUrl;
        }

        function mapToCapabilities(config) {
            return {
                recolorables: [
                    {
                        get: () => config.primary_color || "#4f46e5",
                        set: (value) => {
                            config.primary_color = value;
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ primary_color: value });
                            }
                        }
                    }
                ],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            };
        }

        function mapToEditPanelValues(config) {
            return new Map([
                ["unit_title", config.unit_title || defaultConfig.unit_title],
                ["home_url", config.home_url || defaultConfig.home_url]
            ]);
        }

        // Initialize SDKs
        async function initializeApp() {
            // Initialize Element SDK
            if (window.elementSdk) {
                await window.elementSdk.init({
                    defaultConfig,
                    onConfigChange,
                    mapToCapabilities,
                    mapToEditPanelValues
                });
            }

            // Initialize Data SDK
            if (window.dataSdk) {
                const result = await window.dataSdk.init(dataHandler);
                if (!result.isOk) {
                    console.error("Failed to initialize data SDK");
                }
            }

            setupEventListeners();
            updateVocabularyDisplay(false); // Không phát âm khi khởi tạo
            setupReadingQuiz();
            updateProgressDisplay();
        }

        // Event listeners
        function setupEventListeners() {
            // Tab switching
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => switchTab(button.dataset.tab));
            });

            // Vocabulary controls
            document.getElementById('prev-word').addEventListener('click', previousWord);
            document.getElementById('next-word').addEventListener('click', nextWord);
            document.getElementById('flip-card').addEventListener('click', flipCard);


            // Keyboard controls
            document.addEventListener('keydown', handleKeyPress);

            // Vocabulary quiz
            document.getElementById('start-vocab-quiz').addEventListener('click', startVocabularyQuiz);
            document.getElementById('vocab-quiz-submit').addEventListener('click', submitVocabAnswer);
            document.getElementById('vocab-quiz-next').addEventListener('click', nextVocabQuestion);

            // Grammar topics
            document.querySelectorAll('.grammar-topic').forEach(topic => {
                topic.addEventListener('click', () => {
                    const topicType = topic.dataset.topic;
                    if (topicType === 'comprehensive-quiz') {
                        showComprehensiveQuiz();
                    } else {
                        showGrammarContent(topicType);
                    }
                });
            });
        }

        // Tab switching
        function switchTab(tabName) {
            currentTab = tabName;
            
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active', 'bg-green-500', 'bg-blue-500', 'bg-purple-500', 'text-white');
                button.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            const activeButton = document.querySelector(`[data-tab="${tabName}"]`);
            activeButton.classList.remove('bg-gray-200', 'text-gray-700');
            activeButton.classList.add('active', 'text-white');
            
            if (tabName === 'vocabulary') {
                activeButton.classList.add('bg-green-500');
            } else if (tabName === 'reading') {
                activeButton.classList.add('bg-blue-500');
            } else if (tabName === 'grammar') {
                activeButton.classList.add('bg-purple-500');
            }

            // Show/hide content sections
            document.querySelectorAll('.tab-content').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(`${tabName}-section`).classList.remove('hidden');
        }

        // Vocabulary functions
        function updateVocabularyDisplay(shouldAutoPlay = false) {
            const word = vocabularyData[currentWordIndex];
            document.getElementById('word-text').textContent = word.word;
            document.getElementById('word-type').textContent = word.type;
            document.getElementById('word-ipa').textContent = word.ipa;
            document.getElementById('word-meaning').textContent = word.meaning;
            document.getElementById('word-example').textContent = word.example;
            document.getElementById('word-counter').textContent = `${currentWordIndex + 1} / ${vocabularyData.length}`;
            
            // Reset flip state
            isFlipped = false;
            document.getElementById('flashcard').classList.remove('flipped');
            
            // Auto pronounce word only when explicitly requested (from next/prev buttons)
            if (shouldAutoPlay) {
                setTimeout(() => {
                    pronounceWord(word.word);
                }, 500);
            }
        }

        function nextWord() {
            if (currentWordIndex < vocabularyData.length - 1) {
                currentWordIndex++;
                updateVocabularyDisplay(true); // Phát âm tự động khi bấm Tiếp
                updateVocabularyProgress();
            }
        }

        function previousWord() {
            if (currentWordIndex > 0) {
                currentWordIndex--;
                updateVocabularyDisplay(true); // Phát âm tự động khi bấm Lùi
            }
        }

        function flipCard() {
            isFlipped = !isFlipped;
            document.getElementById('flashcard').classList.toggle('flipped');
        }

        function pronounceWord(word) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'en-US';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            }
        }

        function handleKeyPress(event) {
            if (currentTab === 'vocabulary') {
                switch(event.code) {
                    case 'ArrowLeft':
                        event.preventDefault();
                        previousWord();
                        break;
                    case 'ArrowRight':
                        event.preventDefault();
                        nextWord();
                        break;
                    case 'Space':
                        event.preventDefault();
                        flipCard();
                        break;
                }
            }
        }

        // Reading quiz functions
        function setupReadingQuiz() {
            const container = document.getElementById('quiz-container');
            container.innerHTML = '';
            
            readingQuestions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'mb-6 p-4 border rounded-lg';
                questionDiv.innerHTML = `
                    <h4 class="font-semibold mb-3">${index + 1}. ${q.question}</h4>
                    <div class="space-y-2">
                        ${q.options.map((option, optIndex) => `
                            <label class="quiz-option flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="radio" name="q${index}" value="${optIndex}" class="mr-3">
                                <span>${String.fromCharCode(65 + optIndex)}. ${option}</span>
                            </label>
                        `).join('')}
                    </div>
                `;
                container.appendChild(questionDiv);
            });
            
            document.getElementById('submit-reading-quiz').classList.remove('hidden');
            document.getElementById('submit-reading-quiz').addEventListener('click', checkReadingQuiz);
        }

        function checkReadingQuiz() {
            let correct = 0;
            const total = readingQuestions.length;
            
            readingQuestions.forEach((q, index) => {
                const selected = document.querySelector(`input[name="q${index}"]:checked`);
                const options = document.querySelectorAll(`input[name="q${index}"]`);
                
                options.forEach((option, optIndex) => {
                    const label = option.closest('.quiz-option');
                    if (optIndex === q.correct) {
                        label.classList.add('correct');
                    } else if (selected && parseInt(selected.value) === optIndex) {
                        label.classList.add('incorrect');
                    }
                    option.disabled = true;
                });
                
                if (selected && parseInt(selected.value) === q.correct) {
                    correct++;
                    playSound(true);
                } else {
                    playSound(false);
                }
            });
            
            const percentage = Math.round((correct / total) * 100);
            document.getElementById('reading-result').innerHTML = `
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-lg">Kết quả: ${correct}/${total} (${percentage}%)</h4>
                    <p class="text-gray-600">
                        ${percentage >= 80 ? '🎉 Xuất sắc!' : percentage >= 60 ? '👍 Tốt!' : '💪 Cần cố gắng thêm!'}
                    </p>
                </div>
            `;
            document.getElementById('reading-result').classList.remove('hidden');
            document.getElementById('submit-reading-quiz').classList.add('hidden');
            
            updateReadingProgress();
        }

        // Grammar functions
        function showGrammarContent(topic) {
            const content = grammarContent[topic];
            const container = document.getElementById('grammar-content');
            
            container.innerHTML = `
                <h2 class="text-2xl font-bold text-purple-700 mb-4">${content.title}</h2>
                ${content.content}
                <button onclick="hideGrammarContent()" class="mt-6 bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600">
                    ← Quay lại
                </button>
            `;
            container.classList.remove('hidden');
            
            updateGrammarProgress(topic);
        }

        function hideGrammarContent() {
            document.getElementById('grammar-content').classList.add('hidden');
        }

        function showComprehensiveQuiz() {
            const container = document.getElementById('grammar-content');
            let quizHTML = `
                <h2 class="text-2xl font-bold text-purple-700 mb-4">📝 Bài tập tổng hợp</h2>
                <div id="comprehensive-quiz-container">
            `;
            
            // Show first 5 questions as example
            comprehensiveQuiz.forEach((q, index) => {
                quizHTML += `
                    <div class="mb-6 p-4 border rounded-lg">
                        <h4 class="font-semibold mb-3">${index + 1}. ${q.question}</h4>
                        <div class="space-y-2">
                            ${q.options.map((option, optIndex) => `
                                <label class="quiz-option flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                    <input type="radio" name="cq${index}" value="${optIndex}" class="mr-3">
                                    <span>${String.fromCharCode(65 + optIndex)}. ${option}</span>
                                </label>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            
            quizHTML += `
                </div>
                <div class="flex space-x-4">
                    <button onclick="checkComprehensiveQuiz()" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700">
                        Nộp bài
                    </button>
                    <button onclick="hideGrammarContent()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600">
                        ← Quay lại
                    </button>
                </div>
                <div id="comprehensive-result" class="mt-4 hidden"></div>
            `;
            
            container.innerHTML = quizHTML;
            container.classList.remove('hidden');
        }

        function checkComprehensiveQuiz() {
            let correct = 0;
            const total = comprehensiveQuiz.length;
            
            comprehensiveQuiz.forEach((q, index) => {
                const selected = document.querySelector(`input[name="cq${index}"]:checked`);
                const options = document.querySelectorAll(`input[name="cq${index}"]`);
                
                options.forEach((option, optIndex) => {
                    const label = option.closest('.quiz-option');
                    if (optIndex === q.correct) {
                        label.classList.add('correct');
                    } else if (selected && parseInt(selected.value) === optIndex) {
                        label.classList.add('incorrect');
                    }
                    option.disabled = true;
                });
                
                if (selected && parseInt(selected.value) === q.correct) {
                    correct++;
                    playSound(true);
                } else {
                    playSound(false);
                }
            });
            
            const percentage = Math.round((correct / total) * 100);
            document.getElementById('comprehensive-result').innerHTML = `
                <div class="bg-purple-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-lg">Kết quả: ${correct}/${total} (${percentage}%)</h4>
                    <p class="text-gray-600">
                        ${percentage >= 80 ? '🎉 Xuất sắc!' : percentage >= 60 ? '👍 Tốt!' : '💪 Cần cố gắng thêm!'}
                    </p>
                </div>
            `;
            document.getElementById('comprehensive-result').classList.remove('hidden');
        }

        // Progress tracking functions
        async function updateVocabularyProgress() {
            const progress = Math.round(((currentWordIndex + 1) / vocabularyData.length) * 100);
            progressData.vocabulary_progress = progress;
            progressData.vocabulary_current_index = currentWordIndex;
            
            if (window.dataSdk) {
                await window.dataSdk.create(progressData);
            }
        }

        async function updateReadingProgress() {
            progressData.reading_progress = 100;
            progressData.reading_completed = true;
            
            if (window.dataSdk) {
                await window.dataSdk.create(progressData);
            }
        }

        async function updateGrammarProgress(topic) {
            const completedTopics = progressData.grammar_completed_topics.split(',').filter(t => t);
            if (!completedTopics.includes(topic)) {
                completedTopics.push(topic);
                progressData.grammar_completed_topics = completedTopics.join(',');
                progressData.grammar_progress = Math.round((completedTopics.length / 6) * 100); // 5 topics + 1 quiz
                
                if (window.dataSdk) {
                    await window.dataSdk.create(progressData);
                }
            }
        }

        function updateProgressDisplay() {
            const totalProgress = Math.round((progressData.vocabulary_progress + progressData.reading_progress + progressData.grammar_progress) / 3);
            
            document.getElementById('total-progress').textContent = `${totalProgress}%`;
            document.getElementById('vocab-progress').textContent = `${progressData.vocabulary_progress}%`;
            document.getElementById('reading-progress').textContent = `${progressData.reading_progress}%`;
            document.getElementById('grammar-progress').textContent = `${progressData.grammar_progress}%`;
            
            document.getElementById('total-bar').style.width = `${totalProgress}%`;
            document.getElementById('vocab-bar').style.width = `${progressData.vocabulary_progress}%`;
            document.getElementById('reading-bar').style.width = `${progressData.reading_progress}%`;
            document.getElementById('grammar-bar').style.width = `${progressData.grammar_progress}%`;
        }

        // Vocabulary Quiz Functions
        function generateVocabularyQuiz() {
            const quizTypes = [
                'meaning', 'word', 'example', 'type'
            ];
            
            const quiz = [];
            const usedWords = new Set();
            
            // Generate 42 random questions
            while (quiz.length < 42) {
                const randomIndex = Math.floor(Math.random() * vocabularyData.length);
                const word = vocabularyData[randomIndex];
                
                if (usedWords.has(word.word)) continue;
                usedWords.add(word.word);
                
                const questionType = quizTypes[Math.floor(Math.random() * quizTypes.length)];
                let question = {};
                
                switch (questionType) {
                    case 'meaning':
                        question = {
                            question: `"${word.word}" có nghĩa là gì?`,
                            correct: word.meaning,
                            type: 'meaning',
                            word: word.word
                        };
                        break;
                    case 'word':
                        question = {
                            question: `Từ nào có nghĩa là "${word.meaning}"?`,
                            correct: word.word,
                            type: 'word',
                            word: word.word
                        };
                        break;
                    case 'example':
                        question = {
                            question: `Câu nào sử dụng đúng từ "${word.word}"?`,
                            correct: word.example,
                            type: 'example',
                            word: word.word
                        };
                        break;
                    case 'type':
                        question = {
                            question: `"${word.word}" thuộc loại từ nào?`,
                            correct: word.type,
                            type: 'type',
                            word: word.word
                        };
                        break;
                }
                
                // Generate wrong options
                question.options = generateWrongOptions(question, vocabularyData);
                quiz.push(question);
            }
            
            return quiz;
        }
        
        function generateWrongOptions(question, allWords) {
            const options = [question.correct];
            const usedOptions = new Set([question.correct]);
            
            while (options.length < 4) {
                const randomWord = allWords[Math.floor(Math.random() * allWords.length)];
                let wrongOption;
                
                switch (question.type) {
                    case 'meaning':
                        wrongOption = randomWord.meaning;
                        break;
                    case 'word':
                        wrongOption = randomWord.word;
                        break;
                    case 'example':
                        wrongOption = randomWord.example;
                        break;
                    case 'type':
                        wrongOption = randomWord.type;
                        break;
                }
                
                if (!usedOptions.has(wrongOption) && wrongOption !== question.correct) {
                    options.push(wrongOption);
                    usedOptions.add(wrongOption);
                }
            }
            
            // Shuffle options
            for (let i = options.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [options[i], options[j]] = [options[j], options[i]];
            }
            
            return options;
        }
        
        function startVocabularyQuiz() {
            vocabQuizData = generateVocabularyQuiz();
            currentVocabQuizIndex = 0;
            vocabQuizScore = 0;
            vocabQuizAnswers = [];
            
            document.getElementById('start-vocab-quiz').classList.add('hidden');
            document.getElementById('vocab-quiz-container').classList.remove('hidden');
            document.getElementById('vocab-quiz-total').textContent = vocabQuizData.length;
            
            showVocabQuestion();
        }
        
        function showVocabQuestion() {
            const question = vocabQuizData[currentVocabQuizIndex];
            
            document.getElementById('vocab-quiz-current').textContent = currentVocabQuizIndex + 1;
            document.getElementById('vocab-question').textContent = question.question;
            
            const optionsContainer = document.getElementById('vocab-options');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'quiz-option';
                optionDiv.innerHTML = `
                    <label class="flex items-center p-4 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
                        <input type="radio" name="vocab-option" value="${option}" class="mr-3 text-green-600">
                        <span class="text-lg">${String.fromCharCode(65 + index)}. ${option}</span>
                    </label>
                `;
                optionsContainer.appendChild(optionDiv);
            });
            
            // Add event listeners to options
            document.querySelectorAll('input[name="vocab-option"]').forEach(input => {
                input.addEventListener('change', () => {
                    document.getElementById('vocab-quiz-submit').classList.remove('hidden');
                });
            });
            
            // Reset buttons
            document.getElementById('vocab-quiz-submit').classList.add('hidden');
            document.getElementById('vocab-quiz-next').classList.add('hidden');
            document.getElementById('vocab-quiz-result').classList.add('hidden');
        }
        
        function submitVocabAnswer() {
            const selectedOption = document.querySelector('input[name="vocab-option"]:checked');
            if (!selectedOption) return;
            
            const question = vocabQuizData[currentVocabQuizIndex];
            const isCorrect = selectedOption.value === question.correct;
            
            if (isCorrect) {
                vocabQuizScore++;
                playSound(true);
            } else {
                playSound(false);
            }
            
            vocabQuizAnswers.push({
                question: question.question,
                selected: selectedOption.value,
                correct: question.correct,
                isCorrect: isCorrect
            });
            
            // Highlight correct and incorrect answers
            document.querySelectorAll('input[name="vocab-option"]').forEach(input => {
                const label = input.closest('label');
                if (input.value === question.correct) {
                    label.classList.add('border-green-500', 'bg-green-50');
                } else if (input.checked) {
                    label.classList.add('border-red-500', 'bg-red-50');
                }
                input.disabled = true;
            });
            
            // Show result
            const resultDiv = document.getElementById('vocab-quiz-result');
            resultDiv.innerHTML = `
                <div class="text-center p-4 rounded-lg ${isCorrect ? 'bg-green-50 text-green-800' : 'bg-red-50 text-red-800'}">
                    <div class="text-2xl mb-2">${isCorrect ? '✅ Chính xác!' : '❌ Sai rồi!'}</div>
                    ${!isCorrect ? `<div class="text-lg">Đáp án đúng: <strong>${question.correct}</strong></div>` : ''}
                </div>
            `;
            resultDiv.classList.remove('hidden');
            
            document.getElementById('vocab-quiz-submit').classList.add('hidden');
            
            if (currentVocabQuizIndex < vocabQuizData.length - 1) {
                document.getElementById('vocab-quiz-next').classList.remove('hidden');
            } else {
                setTimeout(showVocabFinalResult, 2000);
            }
        }
        
        function nextVocabQuestion() {
            currentVocabQuizIndex++;
            if (currentVocabQuizIndex < vocabQuizData.length) {
                showVocabQuestion();
            }
        }
        
        function showVocabFinalResult() {
            const percentage = Math.round((vocabQuizScore / vocabQuizData.length) * 100);
            
            let message = '';
            if (percentage >= 90) message = '🏆 Xuất sắc! Bạn đã thành thạo từ vựng!';
            else if (percentage >= 80) message = '🎉 Rất tốt! Bạn đã nắm vững từ vựng!';
            else if (percentage >= 70) message = '👍 Tốt! Hãy ôn lại một số từ!';
            else if (percentage >= 60) message = '📚 Khá! Cần luyện tập thêm!';
            else message = '💪 Hãy học lại từ vựng và thử lại!';
            
            document.getElementById('vocab-quiz-final').innerHTML = `
                <div class="bg-gradient-to-r from-green-50 to-blue-50 rounded-lg p-6 text-center">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">🎯 Kết quả cuối cùng</h3>
                    <div class="text-4xl font-bold text-green-600 mb-2">${vocabQuizScore}/${vocabQuizData.length}</div>
                    <div class="text-2xl font-semibold text-blue-600 mb-4">${percentage}%</div>
                    <div class="text-lg text-gray-700 mb-6">${message}</div>
                    <button onclick="restartVocabQuiz()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors mr-4">
                        🔄 Làm lại
                    </button>
                    <button onclick="closeVocabQuiz()" class="bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600 transition-colors">
                        📚 Quay lại học từ vựng
                    </button>
                </div>
            `;
            document.getElementById('vocab-quiz-final').classList.remove('hidden');
            document.getElementById('vocab-quiz-next').classList.add('hidden');
        }
        
        function restartVocabQuiz() {
            document.getElementById('vocab-quiz-final').classList.add('hidden');
            startVocabularyQuiz();
        }
        
        function closeVocabQuiz() {
            document.getElementById('vocab-quiz-container').classList.add('hidden');
            document.getElementById('vocab-quiz-final').classList.add('hidden');
            document.getElementById('start-vocab-quiz').classList.remove('hidden');
        }

        // Sound effects
        function playSound(isCorrect) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            if (isCorrect) {
                // Success sound - ascending notes
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
            } else {
                // Error sound - descending notes
                oscillator.frequency.setValueAtTime(400, audioContext.currentTime); // G4
                oscillator.frequency.setValueAtTime(300, audioContext.currentTime + 0.1); // D4
                oscillator.frequency.setValueAtTime(200, audioContext.currentTime + 0.2); // G3
            }
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        }

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9969f3f9a5b8a088',t:'MTc2MTgxNzI0Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
